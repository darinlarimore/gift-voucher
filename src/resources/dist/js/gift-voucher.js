!function($){void 0===Craft.GiftVoucher&&(Craft.GiftVoucher={});var e="verbb\\giftvoucher\\elements\\Voucher";Craft.GiftVoucher.VoucherIndex=Craft.BaseElementIndex.extend({editableVoucherTypes:null,$newVoucherBtnVoucherType:null,$newVoucherBtn:null,init:function(e,t,i){this.on("selectSource",$.proxy(this,"updateButton")),this.on("selectSite",$.proxy(this,"updateButton")),this.base(e,t,i)},afterInit:function(){this.editableVoucherTypes=[];for(var e=0;e<Craft.GiftVoucher.editableVoucherTypes.length;e++){var t=Craft.GiftVoucher.editableVoucherTypes[e];this.getSourceByKey("voucherType:"+t.id)&&this.editableVoucherTypes.push(t)}this.base()},getDefaultSourceKey:function(){if("index"===this.settings.context&&"undefined"!=typeof defaultVoucherTypeHandle)for(var e=0;e<this.$sources.length;e++){var t=$(this.$sources[e]);if(t.data("handle")===defaultVoucherTypeHandle)return t.data("key")}return this.base()},updateButton:function(){if(this.$source){var e=this.$source.data("handle"),t,i,r;if(this.editableVoucherTypes.length){var n,o;if(this.$newVoucherBtnVoucherType&&this.$newVoucherBtnVoucherType.remove(),e)for(t=0;t<this.editableVoucherTypes.length;t++)if(this.editableVoucherTypes[t].handle===e){n=this.editableVoucherTypes[t];break}if(this.$newVoucherBtnVoucherType=$('<div class="btngroup submit"/>'),n?(i=this._getVoucherTypeTriggerHref(n),r="index"===this.settings.context?Craft.t("gift-voucher","New voucher"):Craft.t("gift-voucher","New {voucherType} voucher",{voucherType:n.name}),this.$newVoucherBtn=$('<a class="btn submit add icon" '+i+">"+Craft.escapeHtml(r)+"</a>").appendTo(this.$newVoucherBtnVoucherType),"index"!==this.settings.context&&this.addListener(this.$newVoucherBtn,"click",(function(e){this._openCreateVoucherModal(e.currentTarget.getAttribute("data-id"))})),this.editableVoucherTypes.length>1&&(o=$('<div class="btn submit menubtn"></div>').appendTo(this.$newVoucherBtnVoucherType))):this.$newVoucherBtn=o=$('<div class="btn submit add icon menubtn">'+Craft.t("gift-voucher","New voucher")+"</div>").appendTo(this.$newVoucherBtnVoucherType),o){for(var a='<div class="menu"><ul>',t=0;t<this.editableVoucherTypes.length;t++){var s=this.editableVoucherTypes[t];"index"!==this.settings.context&&s===n||(i=this._getVoucherTypeTriggerHref(s),r="index"===this.settings.context?s.name:Craft.t("gift-voucher","New {voucherType} voucher",{voucherType:s.name}),a+="<li><a "+i+'">'+Craft.escapeHtml(r)+"</a></li>")}$(a+="</ul></div>").appendTo(this.$newVoucherBtnVoucherType);var h=new Garnish.MenuBtn(o);"index"!==this.settings.context&&h.on("optionSelect",$.proxy((function(e){this._openCreateVoucherModal(e.option.getAttribute("data-id"))}),this))}this.addButton(this.$newVoucherBtnVoucherType)}if("index"===this.settings.context&&"undefined"!=typeof history){var c="gift-voucher/vouchers";e&&(c+="/"+e),history.replaceState({},"",Craft.getUrl(c))}}},_getVoucherTypeTriggerHref:function(e){if("index"===this.settings.context){var t="gift-voucher/vouchers/"+e.handle+"/new";if(this.siteId&&this.siteId!=Craft.primarySiteId)for(var i=0;i<Craft.sites.length;i++)Craft.sites[i].id==this.siteId&&(t+="/"+Craft.sites[i].handle);return'href="'+Craft.getUrl(t)+'"'}return'data-id="'+e.id+'"'},_openCreateVoucherModal:function(t){if(!this.$newVoucherBtn.hasClass("loading")){for(var i,r=0;r<this.editableVoucherTypes.length;r++)if(this.editableVoucherTypes[r].id===t){i=this.editableVoucherTypes[r];break}if(i){this.$newVoucherBtn.addClass("inactive");var n=this.$newVoucherBtn.text();this.$newVoucherBtn.text(Craft.t("gift-voucher","New {voucherType} voucher",{voucherType:i.name})),Craft.createElementEditor(this.elementType,{hudTrigger:this.$newVoucherBtnGroup,elementType:e,siteId:this.siteId,attributes:{typeId:t},onBeginLoading:$.proxy((function(){this.$newVoucherBtn.addClass("loading")}),this),onEndLoading:$.proxy((function(){this.$newVoucherBtn.removeClass("loading")}),this),onHideHud:$.proxy((function(){this.$newVoucherBtn.removeClass("inactive").text(n)}),this),onSaveElement:$.proxy((function(e){var i="voucherType:"+t;this.sourceKey!==i&&this.selectSourceByKey(i),this.selectElementAfterUpdate(e.id),this.updateElements()}),this)})}}}}),Craft.registerElementIndexClass(e,Craft.GiftVoucher.VoucherIndex)}(jQuery),function($){void 0===Craft.GiftVoucher&&(Craft.GiftVoucher={});var e="verbb\\giftvoucher\\elements\\Code";Craft.GiftVoucher.CodeIndex=Craft.BaseElementIndex.extend({afterInit:function(){var e='href="'+Craft.getUrl("gift-voucher/codes/new")+'"',t=Craft.t("gift-voucher","New code");this.$newProductBtnGroup=$('<div class="btngroup submit"/>'),this.$newProductBtn=$('<a class="btn submit add icon" '+e+">"+t+"</a>").appendTo(this.$newProductBtnGroup),this.addButton(this.$newProductBtnGroup),this.base()}});try{Craft.registerElementIndexClass(e,Craft.GiftVoucher.CodeIndex)}catch(e){}}(jQuery),void 0===Craft.GiftVoucher&&(Craft.GiftVoucher={}),function($){Craft.GiftVoucher.CpAddVoucher=Garnish.Base.extend({orderNumber:null,init:function(e){this.orderNumber=e;var t=$('.menubtn[data-icon="settings"]').data("menubtn");if(t){var i=$('<li><a data-action="apply-gift-voucher">'+Craft.t("gift-voucher","Add voucher code")+"</a></li>");t.menu.addOptions(i.children()),i.prependTo(t.menu.$container.children().first()),t.menu.on("optionselect",$.proxy(this,"_handleMenuBtn"))}},_handleMenuBtn:function(e){var t;"apply-gift-voucher"==$(e.selectedOption).data("action")&&new Craft.GiftVoucher.AddCodeModal}}),Craft.GiftVoucher.AddCodeModal=Garnish.Modal.extend({init:function(){this.$form=$('<form class="modal fitted add-code-modal" method="post" accept-charset="UTF-8"/>').appendTo(Garnish.$bod),this.$body=$('<div class="pane"></div>').appendTo(this.$form),Craft.ui.createTextField({label:Craft.t("gift-voucher","Voucher Code"),instructions:Craft.t("gift-voucher","Enter the gift voucher code to be applied on the order."),id:"voucher-code",name:"voucherCode"}).appendTo(this.$body);var e=window.location.pathname.split("/"),t=e[e.length-1];$('<input type="hidden" name="orderId" value="'+t+'">').appendTo(this.$body);var i=$('<div class="footer"/>').appendTo(this.$body),r=$('<div class="buttons right"/>').appendTo(i);this.$cancelBtn=$('<input type="button" class="btn" value="'+Craft.t("commerce","Cancel")+'"/>').appendTo(r),this.$updateBtn=$('<input type="button" class="btn submit" value="'+Craft.t("gift-voucher","Add voucher code")+'"/>').appendTo(r),this.$footerSpinner=$('<div class="spinner right hidden"/>').appendTo(i),Craft.initUiElements(this.$form),this.addListener(this.$cancelBtn,"click","onFadeOut"),this.addListener(this.$updateBtn,"click","onSubmit"),this.base(this.$form,settings)},onFadeOut:function(){this.$form.remove(),this.$shade.remove()},onSubmit:function(e){e.preventDefault(),this.$footerSpinner.removeClass("hidden");var t=this.$form.serialize();Craft.sendActionRequest("POST","gift-voucher/cart/add-code",{data:t}).then((e=>{location.reload()})).catch((({response:e})=>{e&&e.data&&e.data.message?Craft.cp.displayError(e.data.message):Craft.cp.displayError()})).finally((()=>{this.$footerSpinner.addClass("hidden")}))}})}(jQuery);
//# sourceMappingURL=gift-voucher.js.map